{% extends "base.html" %}
{% block title %}{{ pet.name }} — Pet Profile{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-8">
    <h2>{{ pet.name }} <small class="text-muted">({{ pet.species }})</small></h2>
    <p><strong>Breed:</strong> {{ pet.breed|default:"—" }}</p>
    <p><strong>Age:</strong> {{ pet.age }}</p>
    <p><strong>Owner:</strong> <a href="{% url 'owner-detail' pet.owner.id %}">{{ pet.owner.user.get_full_name|default:pet.owner.user.username }}</a></p>

    <hr>
    <h4>Medical Records</h4>
    {% if medical_records %}
      <ul class="list-group mb-3">
        {% for record in medical_records %}
          <li class="list-group-item">
            <div class="d-flex justify-content-between">
              <div>
                <strong>{{ record.date|date:"Y-m-d" }}</strong> — {{ record.diagnosis|truncatechars:120 }}
                <div class="small text-muted">By Dr. {{ record.vet.user.get_full_name|default:record.vet.user.username }}</div>
              </div>
              <div>
                <a href="{% url 'medical-record-detail' record.id %}" class="btn btn-sm btn-outline-primary">View</a>
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted">No records yet.</p>
    {% endif %}

    <h4>Upcoming Appointments</h4>
    {% if appointments %}
      <ul class="list-group">
        {% for appt in appointments %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <strong>{{ appt.date|date:"Y-m-d H:i" }}</strong>
              <div class="small text-muted">With Dr. {{ appt.vet.user.get_full_name|default:appt.vet.user.username }} — {{ appt.status }}</div>
            </div>
            <div>
              <a href="{% url 'appointment-detail' appt.id %}" class="btn btn-sm btn-outline-secondary">Details</a>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted">No appointments scheduled.</p>
    {% endif %}
  </div>

  <div class="col-md-4">
    <div class="card mb-3">
      <div class="card-body">
        <h5 class="card-title">Edit Pet</h5>
        {% if request.user == pet.owner.user %}
          <form method="post">
            {% csrf_token %}
            {{ pet_form.as_p }}
            <button class="btn btn-success btn-sm">Save</button>
          </form>
        {% else %}
          <p class="text-muted">Only the owner can edit this pet.</p>
        {% endif %}
      </div>
    </div>

    <a href="{% url 'appointments-create' %}?pet={{ pet.id }}" class="btn btn-primary w-100 mb-2">Book Appointment</a>
  </div>
</div>
{% endblock %}